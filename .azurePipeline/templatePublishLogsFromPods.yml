# Template to login into Dockerhub, build a docker image and push it.

# Parameters:
# `logsFolderPath` is the folder where the logs from the pods will be stored.
# `releaseName` is the name of the release used to get the relevant list of pods.
# `kubeConfigFile` is the kubeConfigFile path.

parameters:
  logsFolderPath: ''
  releaseName: ''
  kubeConfigFile: ''

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.6'
  condition: failed()
- script: |
    echo "Copy the pods' logs from the release '${{ parameters.releaseName }}' to '${{ parameters.logsFolderPath }}'."
    python ./azurePipeline/getPodsLogs.py ${{ parameters.logsFolderPath }} ${{ parameters.releaseName }}
  displayName: 'Copy the logs from the service pods.'
  condition: failed()
  env:
    KUBECONFIG: ${{ parameters.kubeConfigFile }}
- task: PublishPipelineArtifact@1
  displayName: 'Publish pods logs in Azure'
  inputs:
    artifactName: Artifacts
    targetPath: ${{ parameters.logsFolderPath }}
  condition: failed()